import {
  updateColumnOrders
} from "./chunk-C672JIGV.js";
import {
  ColumnBaseMixin
} from "./chunk-FUN4RVJ7.js";
import {
  microTask
} from "./chunk-QNRFZUBX.js";
import {
  FlattenedNodesObserver
} from "./chunk-IASAGYPQ.js";
import {
  PolymerElement
} from "./chunk-EMDRMWGL.js";

// node_modules/@vaadin/grid/src/vaadin-grid-column-group.js
var GridColumnGroup = class extends ColumnBaseMixin(PolymerElement) {
  static get is() {
    return "vaadin-grid-column-group";
  }
  static get properties() {
    return {
      _childColumns: {
        value: function() {
          return this._getChildColumns(this);
        }
      },
      flexGrow: {
        type: Number,
        readOnly: true
      },
      width: {
        type: String,
        readOnly: true
      },
      _visibleChildColumns: Array,
      _colSpan: Number,
      _rootColumns: Array
    };
  }
  static get observers() {
    return [
      "_updateVisibleChildColumns(_childColumns)",
      "_childColumnsChanged(_childColumns)",
      "_groupFrozenChanged(frozen, _rootColumns)",
      "_groupHiddenChanged(hidden, _rootColumns)",
      "_visibleChildColumnsChanged(_visibleChildColumns)",
      "_colSpanChanged(_colSpan, _headerCell, _footerCell)",
      "_groupOrderChanged(_order, _rootColumns)",
      "_groupReorderStatusChanged(_reorderStatus, _rootColumns)",
      "_groupResizableChanged(resizable, _rootColumns)"
    ];
  }
  connectedCallback() {
    super.connectedCallback();
    this._addNodeObserver();
    this._updateFlexAndWidth();
  }
  disconnectedCallback() {
    super.disconnectedCallback();
    this._observer && this._observer.disconnect();
  }
  _columnPropChanged(path, value) {
    if (path === "hidden") {
      this._preventHiddenCascade = true;
      this._updateVisibleChildColumns(this._childColumns);
      this._preventHiddenCascade = false;
    }
    if (/flexGrow|width|hidden|_childColumns/.test(path)) {
      this._updateFlexAndWidth();
    }
    if (path === "frozen") {
      this.frozen = this.frozen || value;
    }
    if (path === "lastFrozen") {
      this._lastFrozen = this._lastFrozen || value;
    }
  }
  _groupOrderChanged(order, rootColumns) {
    if (rootColumns) {
      const _rootColumns = rootColumns.slice(0);
      if (!order) {
        _rootColumns.forEach((column) => column._order = 0);
        return;
      }
      const trailingZeros = /(0+)$/.exec(order).pop().length;
      const childCountDigits = ~~(Math.log(rootColumns.length) / Math.LN10) + 1;
      const scope = 10 ** (trailingZeros - childCountDigits);
      if (_rootColumns[0] && _rootColumns[0]._order) {
        _rootColumns.sort((a, b) => a._order - b._order);
      }
      updateColumnOrders(_rootColumns, scope, order);
    }
  }
  _groupReorderStatusChanged(reorderStatus, rootColumns) {
    if (reorderStatus === void 0 || rootColumns === void 0) {
      return;
    }
    rootColumns.forEach((column) => column._reorderStatus = reorderStatus);
  }
  _groupResizableChanged(resizable, rootColumns) {
    if (resizable === void 0 || rootColumns === void 0) {
      return;
    }
    rootColumns.forEach((column) => column.resizable = resizable);
  }
  _updateVisibleChildColumns(childColumns) {
    this._visibleChildColumns = Array.prototype.filter.call(childColumns, (col) => !col.hidden);
  }
  _childColumnsChanged(childColumns) {
    if (!this._autoHidden && this.hidden) {
      Array.prototype.forEach.call(childColumns, (column) => column.hidden = true);
      this._updateVisibleChildColumns(childColumns);
    }
  }
  _updateFlexAndWidth() {
    if (!this._visibleChildColumns) {
      return;
    }
    if (this._visibleChildColumns.length) {
      this._setWidth("calc(" + Array.prototype.reduce.call(this._visibleChildColumns, (prev, curr) => prev += " + " + (curr.width || "0px").replace("calc", ""), "").substring(3) + ")");
    } else {
      this._setWidth("0px");
    }
    this._setFlexGrow(Array.prototype.reduce.call(this._visibleChildColumns, (prev, curr) => prev + curr.flexGrow, 0));
  }
  _groupFrozenChanged(frozen, rootColumns) {
    if (rootColumns === void 0 || frozen === void 0) {
      return;
    }
    if (frozen !== false) {
      Array.from(rootColumns).forEach((col) => col.frozen = frozen);
    }
  }
  _groupHiddenChanged(hidden, rootColumns) {
    if (rootColumns && !this._preventHiddenCascade) {
      this._ignoreVisibleChildColumns = true;
      rootColumns.forEach((column) => column.hidden = hidden);
      this._ignoreVisibleChildColumns = false;
    }
    this._columnPropChanged("hidden");
  }
  _visibleChildColumnsChanged(visibleChildColumns) {
    this._colSpan = visibleChildColumns.length;
    if (!this._ignoreVisibleChildColumns) {
      if (visibleChildColumns.length === 0) {
        this._autoHidden = this.hidden = true;
      } else if (this.hidden && this._autoHidden) {
        this._autoHidden = this.hidden = false;
      }
    }
  }
  _colSpanChanged(colSpan, headerCell, footerCell) {
    if (headerCell) {
      headerCell.setAttribute("colspan", colSpan);
      this._grid && this._grid._a11yUpdateCellColspan(headerCell, colSpan);
    }
    if (footerCell) {
      footerCell.setAttribute("colspan", colSpan);
      this._grid && this._grid._a11yUpdateCellColspan(footerCell, colSpan);
    }
  }
  _getChildColumns(el) {
    return FlattenedNodesObserver.getFlattenedNodes(el).filter(this._isColumnElement);
  }
  _addNodeObserver() {
    this._observer = new FlattenedNodesObserver(this, (info) => {
      if (info.addedNodes.filter(this._isColumnElement).length > 0 || info.removedNodes.filter(this._isColumnElement).length > 0) {
        this._preventHiddenCascade = true;
        this._rootColumns = this._getChildColumns(this);
        this._childColumns = this._rootColumns;
        this._preventHiddenCascade = false;
        microTask.run(() => {
          this._grid && this._grid._updateColumnTree && this._grid._updateColumnTree();
        });
      }
    });
    this._observer.flush();
  }
  _isColumnElement(node) {
    return node.nodeType === Node.ELEMENT_NODE && /\bcolumn\b/.test(node.localName);
  }
};
customElements.define(GridColumnGroup.is, GridColumnGroup);
/**
 * @license
 * Copyright (c) 2016 - 2022 Vaadin Ltd.
 * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
 */
//# sourceMappingURL=chunk-AYMBQKWZ.js.map
